import{A as AstroError,U as UnknownContentCollectionError,c as createComponent,R as RenderUndefinedEntryError,u as unescapeHTML,a as renderTemplate,k as escape,l as renderUniqueStylesheet,n as renderScriptElement,o as createHeadAndContent,r as renderComponent}from"./astro/server.js";var e=e=>Object.prototype.toString.call(e),t=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),o=t=>"[object Date]"===e(t),n=t=>"[object RegExp]"===e(t),r=t=>"[object Error]"===e(t),s=t=>"[object Boolean]"===e(t),l=t=>"[object Number]"===e(t),i=t=>"[object String]"===e(t),c=Array.isArray,u=Object.getOwnPropertyDescriptor,a=Object.prototype.propertyIsEnumerable,f=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.keys;function d(e){const t=h(e),n=f(e);for(let r=0;r<n.length;r++)a.call(e,n[r])&&t.push(n[r]);return t}function b(e,t){return!u(e,t)?.writable}function y(e,a){if("object"==typeof e&&null!==e){let u;if(c(e))u=[];else if(o(e))u=new Date(e.getTime?e.getTime():e);else if(n(e))u=new RegExp(e);else if(r(e))u={message:e.message};else if(s(e)||l(e)||i(e))u=Object(e);else{if(t(e))return e.slice();u=Object.create(Object.getPrototypeOf(e))}const f=a.includeSymbols?d:h;for(const t of f(e))u[t]=e[t];return u}return e}var g={includeSymbols:!1,immutable:!1};function m(e,t,n=g){const r=[],o=[];let a=!0;const i=n.includeSymbols?d:h,s=!!n.immutable;return function e(l){const u=s?y(l,n):l,d={};let f=!0;const h={node:u,node_:l,path:[].concat(r),parent:o[o.length-1],parents:o,key:r[r.length-1],isRoot:0===r.length,level:r.length,circular:void 0,isLeaf:!1,notLeaf:!0,notRoot:!0,isFirst:!1,isLast:!1,update:function(e,t=!1){h.isRoot||(h.parent.node[h.key]=e),h.node=e,t&&(f=!1)},delete:function(e){delete h.parent.node[h.key],e&&(f=!1)},remove:function(e){c(h.parent.node)?h.parent.node.splice(h.key,1):delete h.parent.node[h.key],e&&(f=!1)},keys:null,before:function(e){d.before=e},after:function(e){d.after=e},pre:function(e){d.pre=e},post:function(e){d.post=e},stop:function(){a=!1},block:function(){f=!1}};if(!a)return h;function g(){if("object"==typeof h.node&&null!==h.node){h.keys&&h.node_===h.node||(h.keys=i(h.node)),h.isLeaf=0===h.keys.length;for(let e=0;e<o.length;e++)if(o[e].node_===l){h.circular=o[e];break}}else h.isLeaf=!0,h.keys=null;h.notLeaf=!h.isLeaf,h.notRoot=!h.isRoot}g();const m=t(h,h.node);if(void 0!==m&&h.update&&h.update(m),d.before&&d.before(h,h.node),!f)return h;if("object"==typeof h.node&&null!==h.node&&!h.circular){o.push(h),g();for(const[t,n]of Object.entries(h.keys??[])){r.push(n),d.pre&&d.pre(h,h.node[n],n);const o=e(h.node[n]);s&&p.call(h.node,n)&&!b(h.node,n)&&(h.node[n]=o.node),o.isLast=!!h.keys?.length&&+t==h.keys.length-1,o.isFirst=0==+t,d.post&&d.post(h,o),r.pop()}o.pop()}return d.after&&d.after(h,h.node),h}(e).node}var j=class{#e;#t;constructor(e,t=g){this.#e=e,this.#t=t}get(e){let t=this.#e;for(let n=0;t&&n<e.length;n++){const r=e[n];if(!p.call(t,r)||!this.#t.includeSymbols&&"symbol"==typeof r)return;t=t[r]}return t}has(e){let t=this.#e;for(let n=0;t&&n<e.length;n++){const r=e[n];if(!p.call(t,r)||!this.#t.includeSymbols&&"symbol"==typeof r)return!1;t=t[r]}return!0}set(e,t){let n=this.#e,r=0;for(r=0;r<e.length-1;r++){const t=e[r];p.call(n,t)||(n[t]={}),n=n[t]}return n[e[r]]=t,t}map(e){return m(this.#e,e,{immutable:!0,includeSymbols:!!this.#t.includeSymbols})}forEach(e){return this.#e=m(this.#e,e,this.#t),this.#e}reduce(e,t){const n=1===arguments.length;let r=n?this.#e:t;return this.forEach(((t,o)=>{t.isRoot&&n||(r=e(t,r,o))})),r}paths(){const e=[];return this.forEach((t=>{e.push(t.path)})),e}nodes(){const e=[];return this.forEach((t=>{e.push(t.node)})),e}clone(){const e=[],n=[],r=this.#t;return t(this.#e)?this.#e.slice():function t(o){for(let t=0;t<e.length;t++)if(e[t]===o)return n[t];if("object"==typeof o&&null!==o){const a=y(o,r);e.push(o),n.push(a);const i=r.includeSymbols?d:h;for(const e of i(o))a[e]=t(o[e]);return e.pop(),n.pop(),a}return o}(this.#e)}};class Node{value;next;constructor(e){this.value=e}}class Queue{#n;#r;#o;constructor(){this.clear()}enqueue(e){const t=new Node(e);this.#n?(this.#r.next=t,this.#r=t):(this.#n=t,this.#r=t),this.#o++}dequeue(){const e=this.#n;if(e)return this.#n=this.#n.next,this.#o--,e.value}peek(){if(this.#n)return this.#n.value}clear(){this.#n=void 0,this.#r=void 0,this.#o=0}get size(){return this.#o}*[Symbol.iterator](){let e=this.#n;for(;e;)yield e.value,e=e.next}*drain(){for(;this.#n;)yield this.dequeue()}}function pLimit(e){validateConcurrency(e);const t=new Queue;let n=0;const r=()=>{n<e&&t.size>0&&(t.dequeue()(),n++)},o=async(e,t,o)=>{const a=(async()=>e(...o))();t(a);try{await a}catch{}n--,r()},a=(a,...i)=>new Promise((s=>{((a,i,s)=>{new Promise((e=>{t.enqueue(e)})).then(o.bind(void 0,a,i,s)),(async()=>{await Promise.resolve(),n<e&&r()})()})(a,s,i)}));return Object.defineProperties(a,{activeCount:{get:()=>n},pendingCount:{get:()=>t.size},clearQueue:{value(){t.clear()}},concurrency:{get:()=>e,set(o){validateConcurrency(o),e=o,queueMicrotask((()=>{for(;n<e&&t.size>0;)r()}))}}}),a}function validateConcurrency(e){if(!Number.isInteger(e)&&e!==Number.POSITIVE_INFINITY||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up")}function prependForwardSlash(e){return"/"===e[0]?e:"/"+e}function removeTrailingForwardSlash(e){return e.endsWith("/")?e.slice(0,e.length-1):e}function removeLeadingForwardSlash(e){return e.startsWith("/")?e.substring(1):e}function trimSlashes(e){return e.replace(/^\/|\/$/g,"")}function isString(e){return"string"==typeof e||e instanceof String}function joinPaths(...e){return e.filter(isString).map(((t,n)=>0===n?removeTrailingForwardSlash(t):n===e.length-1?removeLeadingForwardSlash(t):trimSlashes(t))).join("/")}function isRemotePath(e){return/^(?:http|ftp|https|ws):?\/\//.test(e)||e.startsWith("data:")}function removeBase(e,t){return e.startsWith(t)?e.slice(removeTrailingForwardSlash(t).length):e}const CONTENT_IMAGE_FLAG="astroContentImageFlag",IMAGE_IMPORT_PREFIX="__ASTRO_IMAGE_",VALID_INPUT_FORMATS=["jpeg","jpg","png","tiff","webp","gif","svg","avif"],VALID_SUPPORTED_FORMATS=["jpeg","jpg","png","tiff","webp","gif","svg","avif"],DEFAULT_OUTPUT_FORMAT="webp",DEFAULT_HASH_PROPS=["src","width","height","format","quality","fit","position"];function imageSrcToImportId(e,t){if(isRemotePath(e=removeBase(e,"__ASTRO_IMAGE_")))return;const n=e.split(".").at(-1)?.toLowerCase();if(!n||!VALID_INPUT_FORMATS.includes(n))return;const r=new URLSearchParams(CONTENT_IMAGE_FLAG);return t&&r.set("importer",t),`${e}?${r.toString()}`}function decode64(e){const t=asciiToBinary(e),n=new ArrayBuffer(t.length),r=new DataView(n);for(let e=0;e<n.byteLength;e++)r.setUint8(e,t.charCodeAt(e));return n}const KEY_STRING="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function asciiToBinary(e){e.length%4==0&&(e=e.replace(/==?$/,""));let t="",n=0,r=0;for(let o=0;o<e.length;o++)n<<=6,n|=KEY_STRING.indexOf(e[o]),r+=6,24===r&&(t+=String.fromCharCode((16711680&n)>>16),t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n),n=r=0);return 12===r?(n>>=4,t+=String.fromCharCode(n)):18===r&&(n>>=2,t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n)),t}const UNDEFINED=-1,HOLE=-2,NAN=-3,POSITIVE_INFINITY=-4,NEGATIVE_INFINITY=-5,NEGATIVE_ZERO=-6;function unflatten(e,t){if("number"==typeof e)return o(e,!0);if(!Array.isArray(e)||0===e.length)throw new Error("Invalid input");const n=e,r=Array(n.length);function o(e,t=!1){if(-1===e)return;if(-3===e)return NaN;if(-4===e)return 1/0;if(-5===e)return-1/0;if(-6===e)return-0;if(t)throw new Error("Invalid input");if(e in r)return r[e];const a=n[e];if(a&&"object"==typeof a)if(Array.isArray(a))if("string"==typeof a[0]){const t=a[0];switch(t){case"Date":r[e]=new Date(a[1]);break;case"Set":const n=new Set;r[e]=n;for(let e=1;e<a.length;e+=1)n.add(o(a[e]));break;case"Map":const i=new Map;r[e]=i;for(let e=1;e<a.length;e+=2)i.set(o(a[e]),o(a[e+1]));break;case"RegExp":r[e]=new RegExp(a[1],a[2]);break;case"Object":r[e]=Object(a[1]);break;case"BigInt":r[e]=BigInt(a[1]);break;case"null":const s=Object.create(null);r[e]=s;for(let e=1;e<a.length;e+=2)s[a[e]]=o(a[e+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const n=new(0,globalThis[t])(decode64(a[1]));r[e]=n;break}case"ArrayBuffer":{const t=decode64(a[1]);r[e]=t;break}default:throw new Error(`Unknown type ${t}`)}}else{const t=new Array(a.length);r[e]=t;for(let e=0;e<a.length;e+=1){const n=a[e];-2!==n&&(t[e]=o(n))}}else{const t={};r[e]=t;for(const e in a){const n=a[e];t[e]=o(n)}}else r[e]=a;return r[e]}return o(0)}class ImmutableDataStore{_collections=new Map;constructor(){this._collections=new Map}get(e,t){return this._collections.get(e)?.get(String(t))}entries(e){return[...(this._collections.get(e)??new Map).entries()]}values(e){return[...(this._collections.get(e)??new Map).values()]}keys(e){return[...(this._collections.get(e)??new Map).keys()]}has(e,t){const n=this._collections.get(e);return!!n&&n.has(String(t))}hasCollection(e){return this._collections.has(e)}collections(){return this._collections}static async fromModule(){try{const e=await import("./_astro_data-layer-content.js");if(e.default instanceof Map)return ImmutableDataStore.fromMap(e.default);const t=unflatten(e.default);return ImmutableDataStore.fromMap(t)}catch{}return new ImmutableDataStore}static async fromMap(e){const t=new ImmutableDataStore;return t._collections=e,t}}function dataStoreSingleton(){let e;return{get:async()=>(e||(e=ImmutableDataStore.fromModule()),e),set:t=>{e=t}}}const globalDataStore=dataStoreSingleton(),__vite_import_meta_env__={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://xushuhui.github.io",SSR:!0};function createCollectionToGlobResultMap({globResult:e,contentDir:t}){const n={};for(const r in e){const o=r.replace(new RegExp(`^${t}`),"").split("/");if(o.length<=1)continue;const a=o[0];n[a]??={},n[a][r]=e[r]}return n}function createGetCollection({contentCollectionToEntryMap:e,dataCollectionToEntryMap:t,getRenderEntryImport:n,cacheEntriesByCollection:r}){return async function(o,a){const i="function"==typeof a,s=await globalDataStore.get();let c;if(o in e)c="content";else{if(!(o in t)){if(s.hasCollection(o)){const{default:e}=await import("./content-assets.js"),t=[];for(const n of s.values(o)){const r=updateImageReferencesInData(n.data,n.filePath,e);let s={...n,data:r,collection:o};s.legacyId&&(s=emulateLegacyEntry(s)),i&&!a(s)||t.push(s)}return t}return console.warn(`The collection ${JSON.stringify(o)} does not exist or is empty. Please check your content config file for errors.`),[]}c="data"}const l=Object.values("content"===c?e[o]:t[o]);let u=[];if(!Object.assign(__vite_import_meta_env__,{})?.DEV&&r.has(o))u=r.get(o);else{const e=pLimit(10);u=await Promise.all(l.map((t=>e((async()=>{const e=await t();return"content"===c?{id:e.id,slug:e.slug,body:e.body,collection:e.collection,data:e.data,render:async()=>render({collection:e.collection,id:e.id,renderEntryImport:await n(o,e.slug)})}:{id:e.id,collection:e.collection,data:e.data}}))))),r.set(o,u)}return i?u.filter(a):u.slice()}}function emulateLegacyEntry({legacyId:e,...t}){const n={...t,id:e,slug:t.id};return{...n,render:()=>renderEntry(n)}}const CONTENT_LAYER_IMAGE_REGEX=/__ASTRO_IMAGE_="([^"]+)"/g;async function updateImageReferencesInBody(e,t){const{default:n}=await import("./content-assets.js"),r=new Map,{getImage:o}=await import("./_astro_assets.js").then((e=>e._));for(const[a,i]of e.matchAll(CONTENT_LAYER_IMAGE_REGEX))try{const e=JSON.parse(i.replaceAll("&#x22;",'"'));let a;if(URL.canParse(e.src))a=await o(e);else{const i=imageSrcToImportId(e.src,t),s=n.get(i);if(!i||r.has(i)||!s)continue;a=await o({...e,src:s})}r.set(i,a)}catch{throw new Error(`Failed to parse image reference: ${i}`)}return e.replaceAll(CONTENT_LAYER_IMAGE_REGEX,((e,t)=>{const n=r.get(t);if(!n)return e;const{index:o,...a}=n.attributes;return Object.entries({...a,src:n.src,srcset:n.srcSet.attribute}).map((([e,t])=>t?`${e}="${escape(t)}"`:"")).join(" ")}))}function updateImageReferencesInData(e,t,n){return new j(e).map((function(e,r){if("string"==typeof r&&r.startsWith("__ASTRO_IMAGE_")){const o=r.replace("__ASTRO_IMAGE_",""),a=imageSrcToImportId(o,t);if(!a)return void e.update(o);const i=n?.get(a);i?e.update(i):e.update(o)}}))}async function renderEntry(e){if(!e)throw new AstroError(RenderUndefinedEntryError);if("render"in e&&!("legacyId"in e))return e.render();if(e.deferredRender)try{const{default:t}=await import("./content-modules.js"),n=t.get(e.filePath);return render({collection:"",id:e.id,renderEntryImport:n})}catch(e){console.error(e)}const t=e?.rendered?.metadata?.imagePaths?.length&&e.filePath?await updateImageReferencesInBody(e.rendered.html,e.filePath):e?.rendered?.html;return{Content:createComponent((()=>renderTemplate`${unescapeHTML(t)}`)),headings:e?.rendered?.metadata?.headings??[],remarkPluginFrontmatter:e?.rendered?.metadata?.frontmatter??{}}}async function render({collection:e,id:t,renderEntryImport:n}){const r=new AstroError({...UnknownContentCollectionError,message:`Unexpected error while rendering ${String(e)} → ${String(t)}.`});if("function"!=typeof n)throw r;const o=await n();if(null==o||"object"!=typeof o)throw r;const{default:a}=o;if(isPropagatedAssetsModule(a)){const{collectedStyles:e,collectedLinks:n,collectedScripts:o,getMod:i}=a;if("function"!=typeof i)throw r;const s=await i();if(null==s||"object"!=typeof s)throw r;return{Content:createComponent({factory(r,a,i){let c="",l="",u="";Array.isArray(e)&&(c=e.map((e=>renderUniqueStylesheet(r,{type:"inline",content:e}))).join("")),Array.isArray(n)&&(l=n.map((e=>renderUniqueStylesheet(r,{type:"external",src:prependForwardSlash(e)}))).join("")),Array.isArray(o)&&(u=o.map((e=>renderScriptElement(e))).join(""));let d=a;return t.endsWith("mdx")&&(d={components:s.components??{},...a}),createHeadAndContent(unescapeHTML(c+l+u),renderTemplate`${renderComponent(r,"Content",s.Content,d,i)}`)},propagation:"self"}),headings:s.getHeadings?.()??[],remarkPluginFrontmatter:s.frontmatter??{}}}if(o.Content&&"function"==typeof o.Content)return{Content:o.Content,headings:o.getHeadings?.()??[],remarkPluginFrontmatter:o.frontmatter??{}};throw r}function isPropagatedAssetsModule(e){return"object"==typeof e&&null!=e&&"__astroPropagation"in e}const contentDir="/src/content/",contentEntryGlob="",contentCollectionToEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir}),dataEntryGlob="",dataCollectionToEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir});createCollectionToGlobResultMap({globResult:{..."",...""},contentDir:contentDir});let lookupMap={};function createGlobLookup(e){return async(t,n)=>{const r=lookupMap[t]?.entries[n];if(r)return e[t][r]}}lookupMap={},new Set(Object.keys(lookupMap));const renderEntryGlob="",collectionToRenderEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir}),cacheEntriesByCollection=new Map,getCollection=createGetCollection({contentCollectionToEntryMap:contentCollectionToEntryMap,dataCollectionToEntryMap:dataCollectionToEntryMap,getRenderEntryImport:createGlobLookup(collectionToRenderEntryMap),cacheEntriesByCollection:cacheEntriesByCollection});export{DEFAULT_OUTPUT_FORMAT as D,VALID_SUPPORTED_FORMATS as V,DEFAULT_HASH_PROPS as a,getCollection as g,isRemotePath as i,joinPaths as j,renderEntry as r};