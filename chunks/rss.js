import{d as defaultLocale,t as themeConfig}from"./config.js";import{u as ui}from"./ui.js";import{g as generateDescription}from"./description.js";import rss from"@astrojs/rss";import{g as getCollection}from"./_astro_content.js";import MarkdownIt from"markdown-it";import sanitizeHtml from"sanitize-html";const parser=new MarkdownIt,{url:url}=themeConfig.site,followConfig=themeConfig.seo?.follow;async function generateRSS({lang:e}={}){const t=ui[e]||ui[defaultLocale],a=t.title,o=t.description,l=[...await getCollection("posts",(({data:t})=>!t.draft&&(t.lang===e||""===t.lang||void 0===e&&t.lang===defaultLocale)))].sort(((e,t)=>new Date(t.data.published).getTime()-new Date(e.data.published).getTime()));return rss({title:a,site:e?`${url}/${e}`:url,description:o,stylesheet:"/rss/rss-style.xsl",customData:`\n    <copyright>Copyright Â© ${(new Date).getFullYear()} ${themeConfig.site.author}</copyright>\n    <language>${e||themeConfig.global.locale}</language>\n    <lastBuildDate>${(new Date).toUTCString()}</lastBuildDate>\n    ${followConfig?.feedID?`<follow_challenge>\n          <feedId>${followConfig.feedID}</feedId>\n          <userId>${followConfig.userID}</userId>\n        </follow_challenge>`:""}\n  `.trim(),items:l.map((e=>({title:e.data.title,link:new URL(`${e.data.lang!==defaultLocale&&""!==e.data.lang?`${e.data.lang}/`:""}posts/${e.data.abbrlink||e.id}/`,url).toString(),description:generateDescription(e,"rss"),pubDate:e.data.published,content:e.body?sanitizeHtml(parser.render(e.body),{allowedTags:sanitizeHtml.defaults.allowedTags.concat(["img"])}):""})))})}export{generateRSS as g};